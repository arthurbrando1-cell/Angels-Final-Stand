<!DOCTYPE html>
<html lang="pt-BR" data-theme="dark">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Gamedevspace | Natal Edition üéÑ</title>
<link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;500;700;900&display=swap" rel="stylesheet">
<script src="https://unpkg.com/lucide@latest"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>

<style>
:root {
    --primary: #ff2e40; --primary-glow: rgba(255, 46, 64, 0.5);
    --secondary: #00ff9c; --gold: #ffd700; --bg-dark: #020205;
    --bg-card: rgba(20, 20, 25, 0.7); --glass: rgba(255, 255, 255, 0.08);
    --border: rgba(255, 255, 255, 0.15); --text-main: #ffffff;
    --text-muted: #b0b0bb; --radius: 16px; --ease: cubic-bezier(0.23, 1, 0.32, 1);
}

* { box-sizing: border-box; outline: none; }
body {
    margin: 0; font-family: 'Outfit', sans-serif; color: var(--text-main); background-color: var(--bg-dark);
    background-image: radial-gradient(circle at 10% 10%, rgba(255, 46, 64, 0.15), transparent 30%), radial-gradient(circle at 90% 90%, rgba(0, 255, 156, 0.08), transparent 30%);
    min-height: 100vh; overflow-x: hidden; position: relative;
}

/* SISTEMA DE NEVE */
#snow-container { position: fixed; inset: 0; pointer-events: none; z-index: 1; overflow: hidden; }
.snowflake { position: absolute; top: -10px; color: #fff; opacity: 0.8; animation: fall linear forwards; }
@keyframes fall { to { transform: translateY(105vh); } }

/* LOADING */
#loading { position: fixed; inset: 0; background: var(--bg-dark); z-index: 9999; display: flex; flex-direction: column; align-items: center; justify-content: center; gap: 20px; transition: 0.5s; }
.loader { width: 50px; height: 50px; border: 4px solid rgba(255,255,255,0.1); border-top-color: var(--primary); border-radius: 50%; animation: rot 1s linear infinite; }
@keyframes rot { 100% { transform: rotate(360deg); } }

/* HEADER ORIGINAL */
header { display: flex; justify-content: space-between; align-items: center; padding: 20px 5%; height: 80px; background: rgba(2, 2, 5, 0.85); backdrop-filter: blur(20px); border-bottom: 1px solid var(--border); position: sticky; top: 0; z-index: 100; }
.brand { font-weight: 900; font-size: 1.6rem; display: flex; align-items: center; gap: 10px; color: #fff; }
.brand span { color: var(--primary); }

.nav-actions { display: flex; gap: 10px; align-items: center; }
.btn-primary { background: linear-gradient(135deg, var(--primary), #d61c2e); color: #fff; font-weight: 700; padding: 10px 24px; border-radius: 99px; border: none; cursor: pointer; transition: 0.3s; display: flex; align-items: center; gap: 8px; }
.user-pill { display: flex; align-items: center; gap: 10px; padding: 6px 16px 6px 6px; background: var(--glass); border: 1px solid var(--border); border-radius: 99px; cursor: pointer; position: relative; }
.user-pill::after { content: 'üéÖ'; position: absolute; top: -12px; left: -5px; font-size: 1.2rem; transform: rotate(-15deg); }
.avatar { width: 32px; height: 32px; border-radius: 50%; object-fit: cover; background: #222; }

/* MODALS DESIGN ORIGINAL */
.modal-overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.9); backdrop-filter: blur(8px); z-index: 2000; display: none; place-items: center; opacity: 0; transition: 0.3s; overflow-y: auto; }
.modal-overlay.open { opacity: 1; display: grid; }
.modal-box { background: #111; border: 1px solid var(--border); width: 90%; max-width: 400px; padding: 30px; border-radius: 24px; position: relative; }
.form-input { width: 100%; padding: 14px; background: #050505; border: 1px solid var(--border); border-radius: 12px; color: #fff; margin-bottom: 15px; }

/* NOVOS ESTILOS DE UPLOAD */
.upload-btn { background: rgba(255,255,255,0.05); border: 1px dashed var(--border); padding: 10px; border-radius: 10px; text-align: center; cursor: pointer; margin-bottom: 15px; font-size: 0.8rem; display: block; }
.upload-btn:hover { border-color: var(--secondary); }
.profile-banner-preview { width: 100%; height: 80px; object-fit: cover; border-radius: 10px; margin-bottom: 10px; background: #222; border: 1px solid var(--border); }

/* GRID ORIGINAL */
.main-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 25px; padding: 40px 5%; }
.game-card { background: rgba(30, 30, 35, 0.6); backdrop-filter: blur(10px); border-radius: var(--radius); border: 1px solid var(--border); overflow: hidden; transition: 0.4s; cursor: pointer; }
.game-card:hover { transform: translateY(-8px); border-color: var(--primary); }
.card-img-box { height: 180px; overflow: hidden; position: relative; }
.card-img-box img { width: 100%; height: 100%; object-fit: cover; }
.card-content { padding: 18px; }

/* PLAYER */
.game-player { position: fixed; inset: 0; z-index: 3000; background: #000; display: none; flex-direction: column; }
.player-bar { height: 60px; display: flex; justify-content: space-between; align-items: center; padding: 0 20px; background: #111; }
iframe { flex: 1; border: none; background: #000; }
</style>
</head>
<body>

<div id="loading"><div class="loader"></div><p>CARREGANDO O NATAL...</p></div>
<div id="snow-container"></div>

<header>
    <div class="brand"><i data-lucide="gift"></i> Gamedevspace<span>.Cloud</span></div>
    <div class="nav-actions">
        <button class="btn-primary" onclick="openModal('postModal')"><i data-lucide="plus-circle"></i> POSTAR</button>
        <div class="user-pill" id="userBtn" onclick="openModal('profileModal')">
            <img id="navAvatar" class="avatar" src="https://ui-avatars.com/api/?name=Guest">
            <span id="navName">Login</span>
        </div>
    </div>
</header>

<div class="main-grid" id="grid"></div>

<div class="modal-overlay" id="postModal" onclick="closeOnOverlay(event, this)">
    <div class="modal-box">
        <h2 style="text-align:center">Novo Jogo üéÅ</h2>
        <input id="gTitle" class="form-input" placeholder="Nome do Jogo">
        
        <label class="upload-btn">
            <i data-lucide="file-code"></i> Subir HTML/JS (Base64)
            <input type="file" hidden accept=".html,.js" onchange="toBase64(this, 'gUrl')">
        </label>
        <input id="gUrl" class="form-input" placeholder="URL do Jogo ou Base64">

        <label class="upload-btn">
            <i data-lucide="image"></i> Subir Capa do Jogo
            <input type="file" hidden accept="image/*" onchange="toBase64(this, 'gImg')">
        </label>
        <input id="gImg" class="form-input" placeholder="URL da Capa">

        <select id="gCat" class="form-input">
            <option>Natal üéÑ</option><option>A√ß√£o</option><option>RPG</option><option>Terror</option>
        </select>
        <button class="btn-primary" style="width:100%; justify-content:center" onclick="publishGame()">Publicar</button>
    </div>
</div>

<div class="modal-overlay" id="profileModal" onclick="closeOnOverlay(event, this)">
    <div class="modal-box">
        <div id="loginView">
            <h2 style="text-align:center">Acesso üéÖ</h2>
            <input id="nickInput" class="form-input" placeholder="Nickname">
            <button class="btn-primary" style="width:100%; justify-content:center" onclick="doLogin()">Entrar</button>
        </div>
        <div id="profileView" style="display:none">
            <img id="prevBanner" class="profile-banner-preview" src="">
            <h2 id="viewNick" style="margin-top:0">Nick</h2>
            
            <label class="upload-btn">Subir Foto (ou GIF) <input type="file" hidden onchange="toBase64(this, 'pAv')"></label>
            <input id="pAv" class="form-input" placeholder="URL Foto/GIF">
            
            <label class="upload-btn">Subir Banner (ou GIF) <input type="file" hidden onchange="toBase64(this, 'pBan')"></label>
            <input id="pBan" class="form-input" placeholder="URL Banner/GIF">
            
            <button class="btn-primary" style="width:100%; justify-content:center" onclick="saveProfile()">Salvar</button>
            <button onclick="doLogout()" style="width:100%; background:none; border:none; color:#ff2e40; margin-top:15px; cursor:pointer">Sair</button>
        </div>
    </div>
</div>

<div class="game-player" id="player">
    <div class="player-bar">
        <button onclick="closeGame()" style="background:none; border:none; color:#fff; cursor:pointer"><i data-lucide="arrow-left"></i></button>
        <span id="pTitle">Jogo</span>
        <div style="width:30px"></div>
    </div>
    <iframe id="gameFrame"></iframe>
</div>

<script>
// CONFIG FIREBASE (Preencha para funcionar)
const firebaseConfig = { apiKey: "", authDomain: "gamehub-b8338.firebaseapp.com", projectId: "gamehub-b8338" };
if(!firebase.apps.length) firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

let user = JSON.parse(localStorage.getItem("gs_user")) || null;

window.onload = () => {
    lucide.createIcons();
    loadGames();
    updateUI();
    startSnow();
    // For√ßa sa√≠da do loading
    setTimeout(() => { document.getElementById('loading').style.display = 'none'; }, 1500);
};

// --- BASE 64 ---
function toBase64(input, target) {
    const file = input.files[0];
    const reader = new FileReader();
    reader.onloadend = () => {
        document.getElementById(target).value = reader.result;
        if(target === 'pBan') prevBanner.src = reader.result;
    };
    reader.readAsDataURL(file);
}

// --- LOGIN & PERFIL ---
function doLogin() {
    const n = nickInput.value.trim();
    if(!n) return;
    db.collection("users").doc(n).get().then(doc => {
        user = doc.exists ? doc.data() : { nick: n, avatar: "", banner: "" };
        localStorage.setItem("gs_user", JSON.stringify(user));
        updateUI();
    });
}

function saveProfile() {
    user.avatar = pAv.value;
    user.banner = pBan.value;
    db.collection("users").doc(user.nick).set(user).then(() => {
        localStorage.setItem("gs_user", JSON.stringify(user));
        updateUI();
        closeModals();
    });
}

function doLogout() { localStorage.removeItem("gs_user"); location.reload(); }

function updateUI() {
    if(user) {
        navName.innerText = user.nick;
        navAvatar.src = user.avatar || `https://api.dicebear.com/7.x/avataaars/svg?seed=${user.nick}`;
        loginView.style.display = 'none';
        profileView.style.display = 'block';
        viewNick.innerText = user.nick;
        pAv.value = user.avatar;
        pBan.value = user.banner;
        prevBanner.src = user.banner;
    }
}

// --- JOGOS ---
function publishGame() {
    if(!user) return alert("Logue primeiro!");
    db.collection("games").add({
        title: gTitle.value, url: gUrl.value, img: gImg.value, category: gCat.value,
        likes: 0, createdAt: firebase.firestore.FieldValue.serverTimestamp()
    }).then(() => { closeModals(); alert("Postado!"); });
}

function loadGames() {
    db.collection("games").orderBy("createdAt", "desc").onSnapshot(snap => {
        grid.innerHTML = "";
        snap.forEach(doc => {
            const g = doc.data();
            grid.innerHTML += `
                <div class="game-card" onclick="openGame('${g.url}', '${g.title}')">
                    <div class="card-img-box"><img src="${g.img}"></div>
                    <div class="card-content">
                        <div style="font-weight:700">${g.title}</div>
                        <div style="font-size:0.8rem; color:var(--text-muted)">${g.category}</div>
                    </div>
                </div>`;
        });
    });
}

function openGame(url, title) {
    player.style.display = 'flex';
    gameFrame.src = url;
    pTitle.innerText = title;
}
function closeGame() { player.style.display = 'none'; gameFrame.src = ""; }

// --- UTILS ---
function openModal(id) { document.getElementById(id).classList.add('open'); }
function closeModals() { document.querySelectorAll('.modal-overlay').forEach(m => m.classList.remove('open')); }
function closeOnOverlay(e, el) { if(e.target === el) closeModals(); }

function startSnow() {
    const sc = document.getElementById('snow-container');
    for(let i=0; i<30; i++) {
        const f = document.createElement('div');
        f.className = 'snowflake'; f.innerText = '‚ùÑ';
        f.style.left = Math.random() * 100 + 'vw';
        f.style.animationDuration = (Math.random() * 5 + 5) + 's';
        sc.appendChild(f);
    }
}
</script>
</body>
</html>
