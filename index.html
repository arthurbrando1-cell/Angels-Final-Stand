<!DOCTYPE html>
<html lang="pt-BR" data-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gamedevspace | Natal Edition üéÑ</title>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;500;700;900&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>

    <style>
        :root {
            --primary: #ff2e40; --primary-glow: rgba(255, 46, 64, 0.5);
            --secondary: #00ff9c; --gold: #ffd700; --bg-dark: #020205;
            --bg-card: rgba(20, 20, 25, 0.7); --glass: rgba(255, 255, 255, 0.08);
            --border: rgba(255, 255, 255, 0.15); --text-main: #ffffff;
            --text-muted: #b0b0bb; --radius: 16px;
        }

        * { box-sizing: border-box; outline: none; }
        body {
            margin: 0; font-family: 'Outfit', sans-serif; color: var(--text-main); background-color: var(--bg-dark);
            background-image: radial-gradient(circle at 10% 10%, rgba(255, 46, 64, 0.15), transparent 30%), radial-gradient(circle at 90% 90%, rgba(0, 255, 156, 0.08), transparent 30%);
            min-height: 100vh; overflow-x: hidden;
        }

        /* NEVE */
        #snow-container { position: fixed; inset: 0; pointer-events: none; z-index: 1; overflow: hidden; }
        .snowflake { position: absolute; top: -10px; color: #fff; animation: fall linear forwards; }
        @keyframes fall { to { transform: translateY(105vh); } }

        /* HEADER */
        header { display: flex; justify-content: space-between; align-items: center; padding: 20px 5%; height: 80px; background: rgba(2, 2, 5, 0.85); backdrop-filter: blur(20px); border-bottom: 1px solid var(--border); position: sticky; top: 0; z-index: 100; }
        .brand { font-weight: 900; font-size: 1.6rem; display: flex; align-items: center; gap: 10px; }
        .brand span { color: var(--primary); }

        .nav-actions { display: flex; gap: 10px; align-items: center; }
        .btn-primary { background: linear-gradient(135deg, var(--primary), #d61c2e); color: #fff; font-weight: 700; padding: 10px 24px; border-radius: 99px; border: none; cursor: pointer; display: flex; align-items: center; gap: 8px; transition: 0.3s; }
        
        /* USER PILL COM GIF SUPORT */
        .user-pill { display: flex; align-items: center; gap: 10px; padding: 6px 16px 6px 6px; background: var(--glass); border: 1px solid var(--border); border-radius: 99px; cursor: pointer; position: relative; }
        .user-pill::after { content: 'üéÖ'; position: absolute; top: -12px; left: -5px; font-size: 1.2rem; transform: rotate(-15deg); }
        .avatar { width: 32px; height: 32px; border-radius: 50%; object-fit: cover; background: #222; border: 1px solid var(--primary); }

        /* BIBLIOTECA GRID */
        .main-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 25px; padding: 40px 5%; }
        .game-card { background: var(--bg-card); border-radius: var(--radius); border: 1px solid var(--border); overflow: hidden; transition: 0.3s; cursor: pointer; position: relative; }
        .game-card:hover { transform: translateY(-5px); border-color: var(--primary); box-shadow: 0 10px 30px var(--primary-glow); }
        .card-img { width: 100%; height: 160px; object-fit: cover; }
        .card-body { padding: 15px; }

        /* MODAIS */
        .modal-overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.9); backdrop-filter: blur(8px); z-index: 2000; display: none; place-items: center; overflow-y: auto; padding: 20px; }
        .modal-box { background: #111; border: 1px solid var(--border); width: 100%; max-width: 450px; padding: 30px; border-radius: 24px; }
        .form-input { width: 100%; padding: 12px; background: #050505; border: 1px solid var(--border); border-radius: 10px; color: #fff; margin-bottom: 15px; }
        .profile-banner { width: 100%; height: 120px; object-fit: cover; border-radius: 12px; margin-bottom: 10px; background: #222; border: 1px solid var(--border); }

        /* PLAYER & TELA CHEIA */
        .game-player { position: fixed; inset: 0; background: #000; z-index: 5000; display: none; flex-direction: column; }
        .player-header { height: 60px; background: #111; display: flex; align-items: center; padding: 0 20px; justify-content: space-between; border-bottom: 1px solid var(--border); }
        iframe { width: 100%; height: 100%; border: none; flex: 1; }
        
        .player-footer { background: #0a0a0a; padding: 20px; display: flex; flex-direction: column; gap: 15px; max-height: 40vh; overflow-y: auto; }
        .comment-box { background: var(--glass); padding: 10px; border-radius: 8px; margin-top: 5px; font-size: 0.9rem; border-left: 3px solid var(--primary); }

        .delete-btn { position: absolute; top: 10px; right: 10px; background: var(--primary); border: none; color: #fff; border-radius: 8px; padding: 5px; cursor: pointer; z-index: 5; }
    </style>
</head>
<body>

<div id="snow-container"></div>

<header>
    <div class="brand"><i data-lucide="gift"></i> Gamedevspace<span>.Cloud</span></div>
    <div class="nav-actions">
        <button class="btn-primary" onclick="openModal('postModal')"><i data-lucide="plus"></i> POSTAR</button>
        <div class="user-pill" onclick="openModal('profileModal')">
            <img id="navAvatar" class="avatar" src="https://ui-avatars.com/api/?name=Guest">
            <span id="navName">Login</span>
        </div>
    </div>
</header>

<div style="padding: 20px 5% 0; display: flex; gap: 10px; overflow-x: auto;" id="catBar">
    </div>

<div class="main-grid" id="gameGrid"></div>

<div class="modal-overlay" id="postModal" onclick="closeOnOverlay(event, this)">
    <div class="modal-box">
        <h2 style="margin-top:0">üéÅ Novo Jogo na Biblioteca</h2>
        <input id="gTitle" class="form-input" placeholder="T√≠tulo do Jogo">
        <input id="gUrl" class="form-input" placeholder="URL do Jogo (Embed)">
        
        <div style="display:flex; gap:10px; align-items: center; margin-bottom:15px">
            <input id="gImg" class="form-input" placeholder="URL da Capa ou GIF" style="margin-bottom:0; flex:1">
            <input type="file" id="fCapa" hidden accept="image/*" onchange="uploadCapa(this)">
            <button class="btn-primary" style="padding: 10px;" onclick="document.getElementById('fCapa').click()"><i data-lucide="upload"></i></button>
        </div>

        <select id="gCat" class="form-input">
            <option>Natal üéÑ</option><option>A√ß√£o</option><option>Aventura</option><option>RPG</option>
            <option>Terror</option><option>Luta</option><option>Estrat√©gia</option><option>Corrida</option>
        </select>
        <button class="btn-primary" style="width:100%; justify-content:center" onclick="saveGame()">ADICIONAR √Ä BIBLIOTECA</button>
    </div>
</div>

<div class="modal-overlay" id="profileModal" onclick="closeOnOverlay(event, this)">
    <div class="modal-box">
        <div id="authDiv">
            <h2>Acesso üéÖ</h2>
            <input id="loginNick" class="form-input" placeholder="Seu Nickname">
            <button class="btn-primary" style="width:100%; justify-content:center" onclick="doLogin()">Entrar</button>
        </div>
        <div id="userDiv" style="display:none">
            <img id="pBannerView" class="profile-banner" src="https://placehold.co/600x200?text=Seu+Banner+GIF">
            <h2 id="pNickTitle" style="margin:0">Nick</h2>
            <p style="font-size:0.8rem; color:var(--text-muted); margin-bottom:20px">Personalize seu perfil com GIFs</p>

            <label>Link do Avatar (GIF/Foto):</label>
            <input id="pAvUrl" class="form-input" placeholder="Cole a URL do GIF">
            
            <label>Link do Banner (GIF/Foto):</label>
            <input id="pBanUrl" class="form-input" placeholder="Cole a URL do GIF">
            
            <button class="btn-primary" style="width:100%; justify-content:center" onclick="saveProfile()">SALVAR ALTERA√á√ïES</button>
            <button onclick="doLogout()" style="width:100%; background:none; border:none; color:red; cursor:pointer; margin-top:15px">Sair da Conta</button>
        </div>
    </div>
</div>

<div class="game-player" id="player">
    <div class="player-header">
        <button onclick="closePlayer()" style="background:none; border:none; color:#fff; cursor:pointer"><i data-lucide="x"></i></button>
        <span id="playingTitle" style="font-weight:700">Carregando...</span>
        <button onclick="toggleFS()" style="background:none; border:none; color:#fff; cursor:pointer" title="Tela Cheia"><i data-lucide="maximize"></i></button>
    </div>
    <iframe id="gameFrame" allowfullscreen></iframe>
    <div class="player-footer">
        <div style="display:flex; justify-content:space-between; align-items:center">
            <button onclick="likeGame()" id="btnLike" style="background:var(--glass); border:1px solid var(--primary); color:#fff; padding:8px 20px; border-radius:99px; cursor:pointer; display:flex; gap:8px">
                ‚ù§Ô∏è <span id="likeCount">0</span> Likes
            </button>
            <span id="playingAuthor" style="font-size:0.8rem; color:var(--text-muted)"></span>
        </div>
        <div id="commentsArea">
            <div style="display:flex; gap:10px">
                <input id="comInput" class="form-input" placeholder="O que achou do jogo?" style="margin-bottom:0">
                <button class="btn-primary" onclick="addComment()">Comentar</button>
            </div>
            <div id="commentsList" style="margin-top:15px"></div>
        </div>
    </div>
</div>

<script>
// CONFIG FIREBASE
const firebaseConfig = { apiKey: "SUA_API_KEY", authDomain: "gamehub-b8338.firebaseapp.com", projectId: "gamehub-b8338" };
if(!firebase.apps.length) firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

let user = JSON.parse(localStorage.getItem("gs_user")) || null;
let currentGameId = null;
const categories = ["Todos", "Natal üéÑ", "A√ß√£o", "Aventura", "RPG", "Terror", "Luta", "Estrat√©gia", "Corrida"];

window.onload = () => {
    lucide.createIcons();
    renderCats();
    loadGames();
    updateUI();
    startSnow();
};

// --- UPLOAD CAPA LOCAL (Base64) ---
function uploadCapa(input) {
    if (input.files && input.files[0]) {
        const reader = new FileReader();
        reader.onload = (e) => { document.getElementById('gImg').value = e.target.result; };
        reader.readAsDataURL(input.files[0]);
    }
}

// --- CATEGORIAS ---
function renderCats() {
    catBar.innerHTML = categories.map(c => `<button onclick="loadGames('${c}')" style="background:var(--glass); border:1px solid var(--border); color:#fff; padding:5px 15px; border-radius:99px; cursor:pointer; white-space:nowrap">${c}</button>`).join('');
}

// --- AUTH ---
function doLogin() {
    const nick = loginNick.value.trim();
    if(!nick) return;
    db.collection("users").doc(nick).get().then(doc => {
        user = doc.exists ? doc.data() : { nick, avatar: "", banner: "", role: "user" };
        localStorage.setItem("gs_user", JSON.stringify(user));
        location.reload();
    });
}

function saveProfile() {
    user.avatar = pAvUrl.value;
    user.banner = pBanUrl.value;
    db.collection("users").doc(user.nick).set(user).then(() => {
        localStorage.setItem("gs_user", JSON.stringify(user));
        updateUI();
        alert("Perfil atualizado com sucesso!");
    });
}

function doLogout() { localStorage.removeItem("gs_user"); location.reload(); }

function updateUI() {
    if(user) {
        navName.innerText = user.nick;
        navAvatar.src = user.avatar || `https://api.dicebear.com/7.x/avataaars/svg?seed=${user.nick}`;
        authDiv.style.display = 'none';
        userDiv.style.display = 'block';
        pNickTitle.innerText = user.nick;
        pAvUrl.value = user.avatar;
        pBanUrl.value = user.banner;
        pBannerView.src = user.banner || "https://placehold.co/600x200?text=Sem+Banner";
    }
}

// --- BIBLIOTECA (Firestore) ---
function saveGame() {
    if(!user) return alert("Fa√ßa login para postar!");
    const game = {
        title: gTitle.value, url: gUrl.value, img: gImg.value, 
        category: gCat.value, author: user.nick, likes: 0,
        createdAt: firebase.firestore.FieldValue.serverTimestamp()
    };
    db.collection("games").add(game).then(() => {
        alert("Postado na biblioteca!");
        closeModals();
    });
}

function loadGames(filter = "Todos") {
    let query = db.collection("games").orderBy("createdAt", "desc");
    if(filter !== "Todos") query = query.where("category", "==", filter);

    query.onSnapshot(snap => {
        gameGrid.innerHTML = "";
        snap.forEach(doc => {
            const g = doc.data();
            const card = document.createElement('div');
            card.className = "game-card";
            card.onclick = () => openPlayer(doc.id, g);
            card.innerHTML = `
                ${(user?.nick === g.author || user?.nick === 'ADM') ? `<button class="delete-btn" onclick="deleteGame(event,'${doc.id}')">üóëÔ∏è</button>` : ''}
                <img class="card-img" src="${g.img || 'https://placehold.co/400x200?text=Game'}">
                <div class="card-body">
                    <div style="font-weight:700; color:#fff">${g.title}</div>
                    <div style="font-size:0.7rem; color:var(--text-muted); display:flex; justify-content:space-between">
                        <span>${g.category}</span>
                        <span>‚ù§Ô∏è ${g.likes || 0}</span>
                    </div>
                </div>
            `;
            gameGrid.appendChild(card);
        });
    });
}

function deleteGame(e, id) {
    e.stopPropagation();
    if(confirm("Remover da biblioteca permanentemente?")) db.collection("games").doc(id).delete();
}

// --- PLAYER & FUN√á√ïES ---
function openPlayer(id, g) {
    currentGameId = id;
    player.style.display = 'flex';
    playingTitle.innerText = g.title;
    playingAuthor.innerText = "Enviado por: " + g.author;
    gameFrame.src = g.url;
    likeCount.innerText = g.likes || 0;
    loadComments(id);
}

function toggleFS() {
    if (!document.fullscreenElement) gameFrame.requestFullscreen();
    else document.exitFullscreen();
}

function likeGame() {
    if(!user) return alert("Logue para curtir!");
    db.collection("games").doc(currentGameId).update({
        likes: firebase.firestore.FieldValue.increment(1)
    });
}

function addComment() {
    if(!user || !comInput.value) return;
    db.collection("games").doc(currentGameId).collection("comments").add({
        user: user.nick, text: comInput.value, date: Date.now()
    });
    comInput.value = "";
}

function loadComments(id) {
    db.collection("games").doc(id).collection("comments").orderBy("date", "desc").onSnapshot(snap => {
        commentsList.innerHTML = "";
        snap.forEach(doc => {
            const c = doc.data();
            commentsList.innerHTML += `<div class="comment-box"><b>${c.user}:</b> ${c.text}</div>`;
        });
    });
}

function closePlayer() { player.style.display = 'none'; gameFrame.src = ""; }
function openModal(id) { document.getElementById(id).style.display = 'grid'; }
function closeModals() { document.querySelectorAll('.modal-overlay').forEach(m => m.style.display = 'none'); }
function closeOnOverlay(e, el) { if(e.target === el) closeModals(); }

function startSnow() {
    const sc = document.getElementById('snow-container');
    setInterval(() => {
        const f = document.createElement('div'); f.className = 'snowflake'; f.innerText = '‚ùÑ';
        f.style.left = Math.random() * 100 + 'vw';
        f.style.animationDuration = (Math.random() * 3 + 3) + 's';
        sc.appendChild(f);
        setTimeout(() => f.remove(), 5000);
    }, 250);
}
</script>
</body>
</html>
