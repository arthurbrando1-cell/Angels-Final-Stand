<!DOCTYPE html>
<html lang="pt-BR" data-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gamedevspace | Natal Edition ðŸŽ„</title>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;500;700;900&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-storage-compat.js"></script>
    <style>
        :root {
            --primary: #ff2e40; --primary-glow: rgba(255, 46, 64, 0.5);
            --secondary: #00ff9c; --gold: #ffd700; --bg-dark: #020205;
            --bg-card: rgba(20, 20, 25, 0.7); --glass: rgba(255, 255, 255, 0.08);
            --border: rgba(255, 255, 255, 0.15); --text-main: #ffffff;
            --text-muted: #b0b0bb; --radius: 16px; --ease: cubic-bezier(0.23, 1, 0.32, 1);
        }

        * { box-sizing: border-box; outline: none; -webkit-tap-highlight-color: transparent; }
        body {
            margin: 0; font-family: 'Outfit', sans-serif; color: var(--text-main); background-color: var(--bg-dark);
            background-image: radial-gradient(circle at 10% 10%, rgba(255, 46, 64, 0.15), transparent 30%), radial-gradient(circle at 90% 90%, rgba(0, 255, 156, 0.08), transparent 30%);
            min-height: 100vh; overflow-x: hidden; position: relative;
        }

        #snow-container { position: fixed; inset: 0; pointer-events: none; z-index: 1; overflow: hidden; }
        .snowflake { position: absolute; top: -10px; color: #fff; opacity: 0.8; animation: fall linear forwards; }
        @keyframes fall { to { transform: translateY(105vh); } }

        #loading { position: fixed; inset: 0; background: var(--bg-dark); z-index: 9999; display: flex; flex-direction: column; align-items: center; justify-content: center; gap: 20px; transition: 0.5s; }
        .loader { width: 50px; height: 50px; border: 4px solid rgba(255,255,255,0.1); border-top-color: var(--primary); border-bottom-color: var(--secondary); border-radius: 50%; animation: rot 1s linear infinite; box-shadow: 0 0 20px var(--primary-glow); }
        @keyframes rot { 100% { transform: rotate(360deg); } }

        header { display: flex; justify-content: space-between; align-items: center; padding: 20px 5%; height: 80px; background: rgba(2, 2, 5, 0.85); backdrop-filter: blur(20px); border-bottom: 1px solid var(--border); position: sticky; top: 0; z-index: 100; }
        .brand { font-weight: 900; font-size: 1.6rem; display: flex; align-items: center; gap: 10px; color: #fff; }
        .brand span { color: var(--primary); }

        .search-bar { background: var(--glass); border: 1px solid var(--border); padding: 10px 20px; border-radius: 99px; width: 300px; color: #fff; display: none; }
        @media(min-width: 768px) { .search-bar { display: block; } }

        .nav-actions { display: flex; gap: 10px; align-items: center; }
        .btn-primary { background: linear-gradient(135deg, var(--primary), #d61c2e); color: #fff; font-weight: 700; padding: 10px 24px; border-radius: 99px; border: none; cursor: pointer; display: flex; align-items: center; gap: 8px; box-shadow: 0 4px 15px rgba(255, 46, 64, 0.3); }
        .user-pill { display: flex; align-items: center; gap: 10px; padding: 6px 16px 6px 6px; background: var(--glass); border: 1px solid var(--border); border-radius: 99px; cursor: pointer; position: relative; }
        .user-pill::after { content: 'ðŸŽ…'; position: absolute; top: -12px; left: -5px; font-size: 1.2rem; transform: rotate(-15deg); }
        .avatar { width: 32px; height: 32px; border-radius: 50%; object-fit: cover; background: #222; }

        .hero { padding: 40px 5%; text-align: center; }
        .hero h1 { font-size: 3rem; margin: 0; background: linear-gradient(135deg, #fff, var(--primary)); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }

        .filters-wrapper { padding: 20px 5%; display: flex; gap: 10px; overflow-x: auto; }
        .filter-chip { padding: 8px 20px; border-radius: 12px; background: var(--glass); border: 1px solid var(--border); color: var(--text-muted); cursor: pointer; white-space: nowrap; }
        .filter-chip.active { background: var(--primary); color: #fff; }

        .main-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 25px; padding: 40px 5%; }
        .game-card { background: var(--bg-card); border-radius: var(--radius); border: 1px solid var(--border); overflow: hidden; position: relative; transition: 0.3s; cursor: pointer; }
        .game-card:hover { transform: translateY(-5px); border-color: var(--primary); }
        .card-img-box img { width: 100%; height: 180px; object-fit: cover; }
        .card-content { padding: 15px; }

        .delete-btn { position: absolute; top: 10px; right: 10px; background: var(--primary); color: #fff; border: none; padding: 8px; border-radius: 8px; cursor: pointer; z-index: 10; }

        .modal-overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.9); backdrop-filter: blur(8px); z-index: 2000; display: none; place-items: center; }
        .modal-box { background: #111; border: 1px solid var(--border); width: 90%; max-width: 400px; padding: 30px; border-radius: 24px; }
        .form-input { width: 100%; padding: 12px; background: #050505; border: 1px solid var(--border); border-radius: 10px; color: #fff; margin-bottom: 15px; }

        .game-player { position: fixed; inset: 0; z-index: 3000; background: #000; display: none; flex-direction: column; }
        .player-bar { height: 60px; background: #111; display: flex; align-items: center; padding: 0 20px; justify-content: space-between; }
        iframe { flex: 1; border: none; width: 100%; }
        
        #toast-container { position: fixed; bottom: 20px; right: 20px; z-index: 9999; }
        .toast { background: #333; color: #fff; padding: 12px 20px; border-radius: 8px; margin-top: 10px; border-left: 4px solid var(--primary); animation: slide 0.3s forwards; }
        @keyframes slide { from { transform: translateX(100%); } to { transform: translateX(0); } }
    </style>
</head>
<body>

<div id="loading"><div class="loader"></div><p>CARREGANDO O NATAL...</p></div>
<div id="snow-container"></div>
<div id="toast-container"></div>

<header>
    <div class="brand"><i data-lucide="gift"></i> Gamedevspace<span>.Cloud</span></div>
    <input type="text" class="search-bar" id="searchInput" placeholder="Buscar presente..." onkeyup="renderGrid(allGames)">
    <div class="nav-actions">
        <button class="btn-primary" onclick="openModal('postModal')"><i data-lucide="plus-circle"></i> POSTAR</button>
        <div class="user-pill" onclick="openModal('loginModal')">
            <img id="avatar" class="avatar" src="https://ui-avatars.com/api/?name=Guest">
            <span id="userName">Login</span>
        </div>
    </div>
</header>

<div class="hero">
    <h1>Ho Ho Ho! Jogue Agora</h1>
    <p>A maior biblioteca de Natal do Gamedevspace.</p>
</div>

<div class="filters-wrapper" id="filters"></div>
<div class="main-grid" id="grid"></div>

<div class="modal-overlay" id="loginModal" onclick="closeOnOverlay(event, this)">
    <div class="modal-box">
        <h2 style="text-align:center">Acesso Pug ðŸŽ…</h2>
        <input id="nick" class="form-input" placeholder="Nickname">
        <input id="password" type="password" class="form-input" placeholder="Senha (Admin)">
        <button class="btn-primary" style="width:100%; justify-content:center" onclick="login()">Entrar</button>
    </div>
</div>

<div class="modal-overlay" id="postModal" onclick="closeOnOverlay(event, this)">
    <div class="modal-box">
        <h2>Novo Jogo</h2>
        <input id="gTitle" class="form-input" placeholder="TÃ­tulo">
        <select id="contentType" class="form-input" onchange="toggleInputs()">
            <option value="url">URL do Jogo</option>
            <option value="html">CÃ³digo HTML</option>
        </select>
        <input id="gUrl" class="form-input" placeholder="URL do Iframe">
        <textarea id="gHtml" class="form-input" style="display:none; height:80px" placeholder="Cole o HTML"></textarea>
        <input id="gImg" class="form-input" placeholder="URL da Capa">
        <select id="gCat" class="form-input">
            <option>Natal ðŸŽ„</option><option>AÃ§Ã£o</option><option>RPG</option><option>Terror</option>
        </select>
        <button class="btn-primary" style="width:100%; justify-content:center" onclick="postGame()">Publicar</button>
    </div>
</div>

<div class="game-player" id="player">
    <div class="player-bar">
        <button onclick="closeGame()" style="background:none; border:none; color:#fff; cursor:pointer"><i data-lucide="arrow-left"></i></button>
        <span id="playerTitle">Game</span>
        <div style="width:20px"></div>
    </div>
    <iframe id="frame" allowfullscreen></iframe>
</div>

<script>
// COLOQUE SUA API KEY ABAIXO
const firebaseConfig = { apiKey: "", authDomain: "gamehub-b8338.firebaseapp.com", projectId: "gamehub-b8338" };
if(!firebase.apps.length) firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

let user = JSON.parse(localStorage.getItem("gh_user")) || null;
let allGames = [];
const categories = ["Todos", "Natal ðŸŽ„", "AÃ§Ã£o", "RPG", "Terror"];
let currentCat = "Todos";

window.onload = () => {
    lucide.createIcons();
    updateUserUI();
    renderFilters();
    loadGames();
    startSnow();
    setTimeout(() => { document.getElementById('loading').style.display = 'none'; }, 1500);
};

function toggleInputs() {
    const isHtml = document.getElementById('contentType').value === 'html';
    document.getElementById('gUrl').style.display = isHtml ? 'none' : 'block';
    document.getElementById('gHtml').style.display = isHtml ? 'block' : 'none';
}

function startSnow() {
    const container = document.getElementById('snow-container');
    setInterval(() => {
        const flake = document.createElement('div');
        flake.className = 'snowflake'; flake.innerText = 'â„';
        flake.style.left = Math.random() * 100 + 'vw';
        flake.style.animationDuration = (Math.random() * 3 + 4) + 's';
        container.appendChild(flake);
        setTimeout(() => flake.remove(), 6000);
    }, 300);
}

function login() {
    const n = nick.value.trim(), p = password.value;
    user = (n === "ADM" && p === "ADMINBATHONYDEVS") ? {nick: n, role: "admin"} : {nick: n, role: "user"};
    localStorage.setItem("gh_user", JSON.stringify(user));
    location.reload();
}

function updateUserUI() {
    if(user) {
        userName.innerText = user.nick;
        avatar.src = `https://api.dicebear.com/7.x/avataaars/svg?seed=${user.nick}`;
    }
}

function postGame() {
    const data = {
        title: gTitle.value, img: gImg.value, category: gCat.value,
        url: gUrl.value, html: gHtml.value, likes: 0,
        createdAt: firebase.firestore.FieldValue.serverTimestamp()
    };
    db.collection("games").add(data).then(() => { alert("Postado!"); location.reload(); });
}

function loadGames() {
    db.collection("games").orderBy("createdAt", "desc").onSnapshot(snap => {
        allGames = [];
        snap.forEach(d => allGames.push({id: d.id, ...d.data()}));
        renderGrid(allGames);
    });
}

function renderGrid(games) {
    const filtered = games.filter(g => (currentCat === "Todos" || g.category === currentCat) && g.title.toLowerCase().includes(searchInput.value.toLowerCase()));
    grid.innerHTML = filtered.map(g => `
        <div class="game-card" onclick="openGame('${g.id}')">
            <div class="card-img-box">
                ${user?.role === 'admin' ? `<button class="delete-btn" onclick="deleteGame(event, '${g.id}')"><i data-lucide="trash"></i></button>` : ''}
                <img src="${g.img}">
            </div>
            <div class="card-content">
                <div class="card-title">${g.title}</div>
                <div style="color:var(--text-muted); font-size:0.8rem">${g.category}</div>
            </div>
        </div>
    `).join('');
    lucide.createIcons();
}

function deleteGame(e, id) {
    e.stopPropagation();
    if(confirm("Apagar jogo?")) db.collection("games").doc(id).delete();
}

function openGame(id) {
    const g = allGames.find(x => x.id === id);
    player.style.display = 'flex';
    playerTitle.innerText = g.title;
    if(g.html) {
        const doc = frame.contentWindow.document;
        doc.open(); doc.write(g.html); doc.close();
    } else {
        frame.src = g.url;
    }
}

function closeGame() { player.style.display = 'none'; frame.src = ""; }
function renderFilters() { filters.innerHTML = categories.map(c => `<div class="filter-chip ${c===currentCat?'active':''}" onclick="currentCat='${c}'; renderFilters(); renderGrid(allGames)">${c}</div>`).join(''); }
function openModal(id) { document.getElementById(id).style.display = 'grid'; }
function closeModals() { document.querySelectorAll('.modal-overlay').forEach(m => m.style.display = 'none'); }
function closeOnOverlay(e, el) { if(e.target === el) closeModals(); }
</script>
</body>
</html>
